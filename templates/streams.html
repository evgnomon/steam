{% extends "base.html" %}

{% block title %}Stream Subscriptions Demo{% endblock %}

{% block content %}
  <h1>Stream Subscriptions Demo</h1>

  <p>This page demonstrates how <code>&lt;turbo-stream-source&gt;</code> handles subscriptions based on DOM presence.</p>

  <div data-controller="streams-demo">
    <div class="status" data-streams-demo-target="status">Connecting...</div>

    <div class="stream-controls">
      <h2>Stream Controls</h2>
      <p>Toggle streams to see subscribe/unsubscribe behavior in the browser console and server logs.</p>

      <div class="control-buttons">
        <button data-action="click->streams-demo#toggleNotifications">
          <span data-streams-demo-target="notificationsBtn">Subscribe to Notifications</span>
        </button>
        <button data-action="click->streams-demo#toggleAlerts">
          <span data-streams-demo-target="alertsBtn">Subscribe to Alerts</span>
        </button>
      </div>
    </div>

    <div class="streams-container">
      <!-- Greetings stream is always visible -->
      <div class="stream-panel">
        <h3>Greetings Stream (always subscribed)</h3>
        <turbo-subscribe stream="greetings"></turbo-subscribe>
        <div class="input-group">
          <input
            data-streams-demo-target="name"
            type="text"
            placeholder="Enter your name"
            data-action="keydown.enter->streams-demo#greet"
          >
          <button data-action="click->streams-demo#greet">Greet</button>
        </div>
        <ul id="greetings">
          {% for greeting in greetings %}
          <li>{{ greeting }}</li>
          {% endfor %}
        </ul>
      </div>

      <!-- Notifications stream is toggleable -->
      <div class="stream-panel">
        <h3>Notifications Stream</h3>
        <div data-streams-demo-target="notificationsContainer">
          <p><em>Not subscribed to notifications stream</em></p>
          <ul id="notifications"></ul>
        </div>
      </div>

      <!-- Alerts stream is toggleable -->
      <div class="stream-panel">
        <h3>Alerts Stream</h3>
        <div data-streams-demo-target="alertsContainer">
          <p><em>Not subscribed to alerts stream</em></p>
          <ul id="alerts"></ul>
        </div>
      </div>
    </div>

    <div class="send-controls">
      <h2>Send Test Messages</h2>
      <p>Send messages to different streams (only subscribers receive them):</p>

      <div class="control-buttons">
        <button data-action="click->streams-demo#sendNotification">Send Notification</button>
        <button data-action="click->streams-demo#sendAlert">Send Alert</button>
      </div>
    </div>
  </div>

  <style>
    .stream-controls, .send-controls {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
    }
    .control-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .control-buttons button {
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      background: #007bff;
      color: white;
      cursor: pointer;
    }
    .control-buttons button:hover {
      background: #0056b3;
    }
    .streams-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    .stream-panel {
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 8px;
      background: white;
    }
    .stream-panel h3 {
      margin-top: 0;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
    }
    .stream-panel ul {
      max-height: 200px;
      overflow-y: auto;
      padding-left: 20px;
    }
    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    .input-group input {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .input-group button {
      padding: 8px 15px;
      border: none;
      border-radius: 4px;
      background: #28a745;
      color: white;
      cursor: pointer;
    }
  </style>
{% endblock %}

{% block scripts %}
  <script type="module" src="/static/js/turbo-stream-source.js"></script>
  <script type="module" src="/static/js/controllers/streams_demo_controller.js"></script>
{% endblock %}
